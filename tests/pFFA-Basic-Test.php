<?php
error_reporting(E_ALL);
if(!class_exists('adriangibbons\phpFITFileAnalysis')) {
    require __DIR__ . '/../src/phpFITFileAnalysis.php';
}

class BasicTest extends PHPUnit_Framework_TestCase
{
    private $base_dir;
    private $demo_files = [];
    private $valid_files = ['mountain-biking.fit', 'power-analysis.fit', 'road-cycling.fit', 'swim.fit'];
    
    public function setUp()
    {
        $this->base_dir = __DIR__ . '/../demo/fit_files/';
    }
    
    public function testDemoFilesExist()
    {
        $this->demo_files = array_values(array_diff(scandir($this->base_dir), array('..', '.')));
        sort($this->demo_files);
        sort($this->valid_files);
        $this->assertEquals($this->valid_files, $this->demo_files);
        var_dump($this->demo_files);
    }
    
    public function testShowDebugInfo()
    {
        $debug_info = "<h3>Types</h3><table class='table table-condensed table-striped'><thead><th>key</th><th>PHP unpack() format</th></thead><tbody><tr><td>0</td><td>C</td></tr><tr><td>1</td><td>c</td></tr><tr><td>2</td><td>C</td></tr><tr><td>131</td><td>v</td></tr><tr><td>132</td><td>v</td></tr><tr><td>133</td><td>V</td></tr><tr><td>134</td><td>V</td></tr><tr><td>7</td><td>C</td></tr><tr><td>136</td><td>f</td></tr><tr><td>137</td><td>d</td></tr><tr><td>10</td><td>C</td></tr><tr><td>139</td><td>v</td></tr><tr><td>140</td><td>V</td></tr><tr><td>13</td><td>C</td></tr></tbody></table><br><hr><br><h3>Messages and Fields being listened for</h3><h4>file_id (0)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>type</td><td>1</td><td>0</td><td></td></tr><tr><td>1</td><td>manufacturer</td><td>1</td><td>0</td><td></td></tr><tr><td>2</td><td>product</td><td>1</td><td>0</td><td></td></tr><tr><td>3</td><td>serial_number</td><td>1</td><td>0</td><td></td></tr><tr><td>4</td><td>time_created</td><td>1</td><td>0</td><td></td></tr><tr><td>5</td><td>number</td><td>1</td><td>0</td><td></td></tr></tbody></table><br><br><h4>device_settings (2)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>active_time_zone</td><td>1</td><td>0</td><td></td></tr><tr><td>1</td><td>utc_offset</td><td>1</td><td>0</td><td></td></tr><tr><td>5</td><td>time_zone_offset</td><td>4</td><td>0</td><td>hr</td></tr></tbody></table><br><br><h4>user_profile (3)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>friendly_name</td><td>1</td><td>0</td><td></td></tr><tr><td>1</td><td>gender</td><td>1</td><td>0</td><td></td></tr><tr><td>2</td><td>age</td><td>1</td><td>0</td><td>years</td></tr><tr><td>3</td><td>height</td><td>100</td><td>0</td><td>m</td></tr><tr><td>4</td><td>weight</td><td>10</td><td>0</td><td>kg</td></tr><tr><td>5</td><td>language</td><td>1</td><td>0</td><td></td></tr><tr><td>6</td><td>elev_setting</td><td>1</td><td>0</td><td></td></tr><tr><td>7</td><td>weight_setting</td><td>1</td><td>0</td><td></td></tr><tr><td>8</td><td>resting_heart_rate</td><td>1</td><td>0</td><td>bpm</td></tr><tr><td>10</td><td>default_max_biking_heart_rate</td><td>1</td><td>0</td><td>bpm</td></tr><tr><td>11</td><td>default_max_heart_rate</td><td>1</td><td>0</td><td>bpm</td></tr><tr><td>12</td><td>hr_setting</td><td>1</td><td>0</td><td></td></tr><tr><td>13</td><td>speed_setting</td><td>1</td><td>0</td><td></td></tr><tr><td>14</td><td>dist_setting</td><td>1</td><td>0</td><td></td></tr><tr><td>16</td><td>power_setting</td><td>1</td><td>0</td><td></td></tr><tr><td>17</td><td>activity_class</td><td>1</td><td>0</td><td></td></tr><tr><td>18</td><td>position_setting</td><td>1</td><td>0</td><td></td></tr><tr><td>21</td><td>temperature_setting</td><td>1</td><td>0</td><td></td></tr></tbody></table><br><br><h4>zones_target (7)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>1</td><td>max_heart_rate</td><td>1</td><td>0</td><td></td></tr><tr><td>2</td><td>threshold_heart_rate</td><td>1</td><td>0</td><td></td></tr><tr><td>3</td><td>functional_threshold_power</td><td>1</td><td>0</td><td></td></tr><tr><td>5</td><td>hr_calc_type</td><td>1</td><td>0</td><td></td></tr><tr><td>7</td><td>pwr_calc_type</td><td>1</td><td>0</td><td></td></tr></tbody></table><br><br><h4>sport (12)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>sport</td><td>1</td><td>0</td><td></td></tr><tr><td>1</td><td>sub_sport</td><td>1</td><td>0</td><td></td></tr><tr><td>3</td><td>name</td><td>1</td><td>0</td><td></td></tr></tbody></table><br><br><h4>session (18)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>event</td><td>1</td><td>0</td><td></td></tr><tr><td>1</td><td>event_type</td><td>1</td><td>0</td><td></td></tr><tr><td>2</td><td>start_time</td><td>1</td><td>0</td><td></td></tr><tr><td>3</td><td>start_position_lat</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>4</td><td>start_position_long</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>5</td><td>sport</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>6</td><td>sub_sport</td><td>1</td><td>0</td><td></td></tr><tr><td>7</td><td>total_elapsed_time</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>8</td><td>total_timer_time</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>9</td><td>total_distance</td><td>100</td><td>0</td><td>m</td></tr><tr><td>10</td><td>total_cycles</td><td>1</td><td>0</td><td>cycles</td></tr><tr><td>11</td><td>total_calories</td><td>1</td><td>0</td><td>kcal</td></tr><tr><td>13</td><td>total_fat_calories</td><td>1</td><td>0</td><td>kcal</td></tr><tr><td>14</td><td>avg_speed</td><td>1000</td><td>0</td><td>m/s</td></tr><tr><td>15</td><td>max_speed</td><td>1000</td><td>0</td><td>m/s</td></tr><tr><td>16</td><td>avg_heart_rate</td><td>1</td><td>0</td><td>bpm</td></tr><tr><td>17</td><td>max_heart_rate</td><td>1</td><td>0</td><td>bpm</td></tr><tr><td>18</td><td>avg_cadence</td><td>1</td><td>0</td><td>rpm</td></tr><tr><td>19</td><td>max_cadence</td><td>1</td><td>0</td><td>rpm</td></tr><tr><td>20</td><td>avg_power</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>21</td><td>max_power</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>22</td><td>total_ascent</td><td>1</td><td>0</td><td>m</td></tr><tr><td>23</td><td>total_descent</td><td>1</td><td>0</td><td>m</td></tr><tr><td>24</td><td>total_training_effect</td><td>10</td><td>0</td><td></td></tr><tr><td>25</td><td>first_lap_index</td><td>1</td><td>0</td><td></td></tr><tr><td>26</td><td>num_laps</td><td>1</td><td>0</td><td></td></tr><tr><td>27</td><td>event_group</td><td>1</td><td>0</td><td></td></tr><tr><td>28</td><td>trigger</td><td>1</td><td>0</td><td></td></tr><tr><td>29</td><td>nec_lat</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>30</td><td>nec_long</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>31</td><td>swc_lat</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>32</td><td>swc_long</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>34</td><td>normalized_power</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>35</td><td>training_stress_score</td><td>10</td><td>0</td><td>tss</td></tr><tr><td>36</td><td>intensity_factor</td><td>1000</td><td>0</td><td>if</td></tr><tr><td>37</td><td>left_right_balance</td><td>1</td><td>0</td><td></td></tr><tr><td>41</td><td>avg_stroke_count</td><td>10</td><td>0</td><td>strokes/lap</td></tr><tr><td>42</td><td>avg_stroke_distance</td><td>100</td><td>0</td><td>m</td></tr><tr><td>43</td><td>swim_stroke</td><td>1</td><td>0</td><td>swim_stroke</td></tr><tr><td>44</td><td>pool_length</td><td>100</td><td>0</td><td>m</td></tr><tr><td>45</td><td>threshold_power</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>46</td><td>pool_length_unit</td><td>1</td><td>0</td><td></td></tr><tr><td>47</td><td>num_active_lengths</td><td>1</td><td>0</td><td>lengths</td></tr><tr><td>48</td><td>total_work</td><td>1</td><td>0</td><td>J</td></tr><tr><td>65</td><td>time_in_hr_zone</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>68</td><td>time_in_power_zone</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>89</td><td>avg_vertical_oscillation</td><td>10</td><td>0</td><td>mm</td></tr><tr><td>90</td><td>avg_stance_time_percent</td><td>100</td><td>0</td><td>percent</td></tr><tr><td>91</td><td>avg_stance_time</td><td>10</td><td>0</td><td>ms</td></tr><tr><td>92</td><td>avg_fractional_cadence</td><td>128</td><td>0</td><td>rpm</td></tr><tr><td>93</td><td>max_fractional_cadence</td><td>128</td><td>0</td><td>rpm</td></tr><tr><td>94</td><td>total_fractional_cycles</td><td>128</td><td>0</td><td>cycles</td></tr><tr><td>101</td><td>avg_left_torque_effectiveness</td><td>2</td><td>0</td><td>percent</td></tr><tr><td>102</td><td>avg_right_torque_effectiveness</td><td>2</td><td>0</td><td>percent</td></tr><tr><td>103</td><td>avg_left_pedal_smoothness</td><td>2</td><td>0</td><td>percent</td></tr><tr><td>104</td><td>avg_right_pedal_smoothness</td><td>2</td><td>0</td><td>percent</td></tr><tr><td>105</td><td>avg_combined_pedal_smoothness</td><td>2</td><td>0</td><td>percent</td></tr><tr><td>111</td><td>sport_index</td><td>1</td><td>0</td><td></td></tr><tr><td>112</td><td>time_standing</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>113</td><td>stand_count</td><td>1</td><td>0</td><td></td></tr><tr><td>114</td><td>avg_left_pco</td><td>1</td><td>0</td><td>mm</td></tr><tr><td>115</td><td>avg_right_pco</td><td>1</td><td>0</td><td>mm</td></tr><tr><td>116</td><td>avg_left_power_phase</td><td>0.7111111</td><td>0</td><td>degrees</td></tr><tr><td>117</td><td>avg_left_power_phase_peak</td><td>0.7111111</td><td>0</td><td>degrees</td></tr><tr><td>118</td><td>avg_right_power_phase</td><td>0.7111111</td><td>0</td><td>degrees</td></tr><tr><td>119</td><td>avg_right_power_phase_peak</td><td>0.7111111</td><td>0</td><td>degrees</td></tr><tr><td>120</td><td>avg_power_position</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>121</td><td>max_power_position</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>122</td><td>avg_cadence_position</td><td>1</td><td>0</td><td>rpm</td></tr><tr><td>123</td><td>max_cadence_position</td><td>1</td><td>0</td><td>rpm</td></tr><tr><td>253</td><td>timestamp</td><td>1</td><td>0</td><td>s</td></tr><tr><td>254</td><td>message_index</td><td>1</td><td>0</td><td></td></tr></tbody></table><br><br><h4>lap (19)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>event</td><td>1</td><td>0</td><td></td></tr><tr><td>1</td><td>event_type</td><td>1</td><td>0</td><td></td></tr><tr><td>2</td><td>start_time</td><td>1</td><td>0</td><td></td></tr><tr><td>3</td><td>start_position_lat</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>4</td><td>start_position_long</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>5</td><td>end_position_lat</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>6</td><td>end_position_long</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>7</td><td>total_elapsed_time</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>8</td><td>total_timer_time</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>9</td><td>total_distance</td><td>100</td><td>0</td><td>m</td></tr><tr><td>10</td><td>total_cycles</td><td>1</td><td>0</td><td>cycles</td></tr><tr><td>11</td><td>total_calories</td><td>1</td><td>0</td><td>kcal</td></tr><tr><td>12</td><td>total_fat_calories</td><td>1</td><td>0</td><td>kcal</td></tr><tr><td>13</td><td>avg_speed</td><td>1000</td><td>0</td><td>m/s</td></tr><tr><td>14</td><td>max_speed</td><td>1000</td><td>0</td><td>m/s</td></tr><tr><td>15</td><td>avg_heart_rate</td><td>1</td><td>0</td><td>bpm</td></tr><tr><td>16</td><td>max_heart_rate</td><td>1</td><td>0</td><td>bpm</td></tr><tr><td>17</td><td>avg_cadence</td><td>1</td><td>0</td><td>rpm</td></tr><tr><td>18</td><td>max_cadence</td><td>1</td><td>0</td><td>rpm</td></tr><tr><td>19</td><td>avg_power</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>20</td><td>max_power</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>21</td><td>total_ascent</td><td>1</td><td>0</td><td>m</td></tr><tr><td>22</td><td>total_descent</td><td>1</td><td>0</td><td>m</td></tr><tr><td>23</td><td>intensity</td><td>1</td><td>0</td><td></td></tr><tr><td>24</td><td>lap_trigger</td><td>1</td><td>0</td><td></td></tr><tr><td>25</td><td>sport</td><td>1</td><td>0</td><td></td></tr><tr><td>26</td><td>event_group</td><td>1</td><td>0</td><td></td></tr><tr><td>32</td><td>num_lengths</td><td>1</td><td>0</td><td>lengths</td></tr><tr><td>33</td><td>normalized_power</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>34</td><td>left_right_balance</td><td>1</td><td>0</td><td></td></tr><tr><td>35</td><td>first_length_index</td><td>1</td><td>0</td><td></td></tr><tr><td>37</td><td>avg_stroke_distance</td><td>100</td><td>0</td><td>m</td></tr><tr><td>38</td><td>swim_stroke</td><td>1</td><td>0</td><td></td></tr><tr><td>39</td><td>sub_sport</td><td>1</td><td>0</td><td></td></tr><tr><td>40</td><td>num_active_lengths</td><td>1</td><td>0</td><td>lengths</td></tr><tr><td>41</td><td>total_work</td><td>1</td><td>0</td><td>J</td></tr><tr><td>57</td><td>time_in_hr_zone</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>60</td><td>time_in_power_zone</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>71</td><td>wkt_step_index</td><td>1</td><td>0</td><td></td></tr><tr><td>77</td><td>avg_vertical_oscillation</td><td>10</td><td>0</td><td>mm</td></tr><tr><td>78</td><td>avg_stance_time_percent</td><td>100</td><td>0</td><td>percent</td></tr><tr><td>79</td><td>avg_stance_time</td><td>10</td><td>0</td><td>ms</td></tr><tr><td>80</td><td>avg_fractional_cadence</td><td>128</td><td>0</td><td>rpm</td></tr><tr><td>81</td><td>max_fractional_cadence</td><td>128</td><td>0</td><td>rpm</td></tr><tr><td>82</td><td>total_fractional_cycles</td><td>128</td><td>0</td><td>cycles</td></tr><tr><td>91</td><td>avg_left_torque_effectiveness</td><td>2</td><td>0</td><td>percent</td></tr><tr><td>92</td><td>avg_right_torque_effectiveness</td><td>2</td><td>0</td><td>percent</td></tr><tr><td>93</td><td>avg_left_pedal_smoothness</td><td>2</td><td>0</td><td>percent</td></tr><tr><td>94</td><td>avg_right_pedal_smoothness</td><td>2</td><td>0</td><td>percent</td></tr><tr><td>95</td><td>avg_combined_pedal_smoothness</td><td>2</td><td>0</td><td>percent</td></tr><tr><td>98</td><td>time_standing</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>99</td><td>stand_count</td><td>1</td><td>0</td><td></td></tr><tr><td>100</td><td>avg_left_pco</td><td>1</td><td>0</td><td>mm</td></tr><tr><td>101</td><td>avg_right_pco</td><td>1</td><td>0</td><td>mm</td></tr><tr><td>102</td><td>avg_left_power_phase</td><td>0.7111111</td><td>0</td><td>degrees</td></tr><tr><td>103</td><td>avg_left_power_phase_peak</td><td>0.7111111</td><td>0</td><td>degrees</td></tr><tr><td>104</td><td>avg_right_power_phase</td><td>0.7111111</td><td>0</td><td>degrees</td></tr><tr><td>105</td><td>avg_right_power_phase_peak</td><td>0.7111111</td><td>0</td><td>degrees</td></tr><tr><td>106</td><td>avg_power_position</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>107</td><td>max_power_position</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>108</td><td>avg_cadence_position</td><td>1</td><td>0</td><td>rpm</td></tr><tr><td>109</td><td>max_cadence_position</td><td>1</td><td>0</td><td>rpm</td></tr><tr><td>253</td><td>timestamp</td><td>1</td><td>0</td><td>s</td></tr><tr><td>254</td><td>message_index</td><td>1</td><td>0</td><td></td></tr></tbody></table><br><br><h4>record (20)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>position_lat</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>1</td><td>position_long</td><td>1</td><td>0</td><td>semicircles</td></tr><tr><td>2</td><td>altitude</td><td>5</td><td>500</td><td>m</td></tr><tr><td>3</td><td>heart_rate</td><td>1</td><td>0</td><td>bpm</td></tr><tr><td>4</td><td>cadence</td><td>1</td><td>0</td><td>rpm</td></tr><tr><td>5</td><td>distance</td><td>100</td><td>0</td><td>m</td></tr><tr><td>6</td><td>speed</td><td>1000</td><td>0</td><td>m/s</td></tr><tr><td>7</td><td>power</td><td>1</td><td>0</td><td>watts</td></tr><tr><td>9</td><td>grade</td><td>100</td><td>0</td><td>percent</td></tr><tr><td>10</td><td>resistance</td><td>1</td><td>0</td><td></td></tr><tr><td>13</td><td>temperature</td><td>1</td><td>0</td><td>C</td></tr><tr><td>39</td><td>vertical_oscillation</td><td>10</td><td>0</td><td>mm</td></tr><tr><td>40</td><td>stance_time_percent</td><td>100</td><td>0</td><td>percent</td></tr><tr><td>53</td><td>fractional_cadence</td><td>128</td><td>0</td><td>rpm</td></tr><tr><td>253</td><td>timestamp</td><td>1</td><td>0</td><td>s</td></tr></tbody></table><br><br><h4>event (21)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>event</td><td>1</td><td>0</td><td></td></tr><tr><td>1</td><td>event_type</td><td>1</td><td>0</td><td></td></tr><tr><td>3</td><td>data</td><td>1</td><td>0</td><td></td></tr><tr><td>4</td><td>event_group</td><td>1</td><td>0</td><td></td></tr><tr><td>253</td><td>timestamp</td><td>1</td><td>0</td><td>s</td></tr></tbody></table><br><br><h4>device_info (23)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>device_index</td><td>1</td><td>0</td><td></td></tr><tr><td>1</td><td>device_type</td><td>1</td><td>0</td><td></td></tr><tr><td>2</td><td>manufacturer</td><td>1</td><td>0</td><td></td></tr><tr><td>3</td><td>serial_number</td><td>1</td><td>0</td><td></td></tr><tr><td>4</td><td>product</td><td>1</td><td>0</td><td></td></tr><tr><td>5</td><td>software_version</td><td>1</td><td>0</td><td></td></tr><tr><td>6</td><td>hardware_version</td><td>1</td><td>0</td><td></td></tr><tr><td>7</td><td>cum_operating_time</td><td>1</td><td>0</td><td></td></tr><tr><td>10</td><td>battery_voltage</td><td>1</td><td>0</td><td></td></tr><tr><td>11</td><td>battery_status</td><td>1</td><td>0</td><td></td></tr><tr><td>20</td><td>ant_transmission_type</td><td>1</td><td>0</td><td></td></tr><tr><td>21</td><td>ant_device_number</td><td>1</td><td>0</td><td></td></tr><tr><td>22</td><td>ant_network</td><td>1</td><td>0</td><td></td></tr><tr><td>25</td><td>source_type</td><td>1</td><td>0</td><td></td></tr><tr><td>253</td><td>timestamp</td><td>1</td><td>0</td><td>s</td></tr></tbody></table><br><br><h4>activity (34)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>total_timer_time</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>1</td><td>num_sessions</td><td>1</td><td>0</td><td></td></tr><tr><td>2</td><td>type</td><td>1</td><td>0</td><td></td></tr><tr><td>3</td><td>event</td><td>1</td><td>0</td><td></td></tr><tr><td>4</td><td>event_type</td><td>1</td><td>0</td><td></td></tr><tr><td>5</td><td>local_timestamp</td><td>1</td><td>0</td><td></td></tr><tr><td>6</td><td>event_group</td><td>1</td><td>0</td><td></td></tr><tr><td>253</td><td>timestamp</td><td>1</td><td>0</td><td>s</td></tr></tbody></table><br><br><h4>file_creator (49)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>software_version</td><td>1</td><td>0</td><td></td></tr><tr><td>1</td><td>hardware_version</td><td>1</td><td>0</td><td></td></tr></tbody></table><br><br><h4>length (101)</h4><table class='table table-condensed table-striped'><thead><th>ID</th><th>Name</th><th>Scale</th><th>Offset</th><th>Units</th></thead><tbody><tr><td>0</td><td>event</td><td>1</td><td>0</td><td></td></tr><tr><td>1</td><td>event_type</td><td>1</td><td>0</td><td></td></tr><tr><td>2</td><td>start_time</td><td>1</td><td>0</td><td></td></tr><tr><td>3</td><td>total_elapsed_time</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>4</td><td>total_timer_time</td><td>1000</td><td>0</td><td>s</td></tr><tr><td>5</td><td>total_strokes</td><td>1</td><td>0</td><td>strokes</td></tr><tr><td>6</td><td>avg_speed</td><td>1000</td><td>0</td><td>m/s</td></tr><tr><td>7</td><td>swim_stroke</td><td>1</td><td>0</td><td>swim_stroke</td></tr><tr><td>9</td><td>avg_swimming_cadence</td><td>1</td><td>0</td><td>strokes/min</td></tr><tr><td>10</td><td>event_group</td><td>1</td><td>0</td><td></td></tr><tr><td>11</td><td>total_calories</td><td>1</td><td>0</td><td>kcal</td></tr><tr><td>12</td><td>length_type</td><td>1</td><td>0</td><td></td></tr><tr><td>253</td><td>timestamp</td><td>1</td><td>0</td><td>s</td></tr><tr><td>254</td><td>message_index</td><td>1</td><td>0</td><td></td></tr></tbody></table><br><br><br><hr><br><h3>FIT Definition Messages contained within the file</h3><table class='table table-condensed table-striped'><thead><th>global_mesg_num</th><th>num_fields</th><th>field defns</th><th>total_size</th></thead><tbody><tr><td>0 (file_id)</td><td>6</td><td>defn: 3; size: 4; type: 140 (serial_number)<br>defn: 4; size: 4; type: 134 (time_created)<br>defn: 1; size: 2; type: 132 (manufacturer)<br>defn: 2; size: 2; type: 132 (product)<br>defn: 5; size: 2; type: 132 (number)<br>defn: 0; size: 1; type: 0 (type)<br></td><td>15</td></tr><tr><td>18 (session)</td><td>34</td><td>defn: 253; size: 4; type: 134 (timestamp)<br>defn: 2; size: 4; type: 134 (start_time)<br>defn: 3; size: 4; type: 133 (start_position_lat)<br>defn: 4; size: 4; type: 133 (start_position_long)<br>defn: 7; size: 4; type: 134 (total_elapsed_time)<br>defn: 8; size: 4; type: 134 (total_timer_time)<br>defn: 9; size: 4; type: 134 (total_distance)<br>defn: 10; size: 4; type: 134 (total_cycles)<br>defn: 29; size: 4; type: 133 (nec_lat)<br>defn: 30; size: 4; type: 133 (nec_long)<br>defn: 31; size: 4; type: 133 (swc_lat)<br>defn: 32; size: 4; type: 133 (swc_long)<br>defn: 254; size: 2; type: 132 (message_index)<br>defn: 11; size: 2; type: 132 (total_calories)<br>defn: 13; size: 2; type: 132 (total_fat_calories)<br>defn: 14; size: 2; type: 132 (avg_speed)<br>defn: 15; size: 2; type: 132 (max_speed)<br>defn: 20; size: 2; type: 132 (avg_power)<br>defn: 21; size: 2; type: 132 (max_power)<br>defn: 22; size: 2; type: 132 (total_ascent)<br>defn: 23; size: 2; type: 132 (total_descent)<br>defn: 25; size: 2; type: 132 (first_lap_index)<br>defn: 26; size: 2; type: 132 (num_laps)<br>defn: 0; size: 1; type: 0 (event)<br>defn: 1; size: 1; type: 0 (event_type)<br>defn: 5; size: 1; type: 0 (sport)<br>defn: 6; size: 1; type: 0 (sub_sport)<br>defn: 16; size: 1; type: 2 (avg_heart_rate)<br>defn: 17; size: 1; type: 2 (max_heart_rate)<br>defn: 18; size: 1; type: 2 (avg_cadence)<br>defn: 19; size: 1; type: 2 (max_cadence)<br>defn: 24; size: 1; type: 2 (total_training_effect)<br>defn: 27; size: 1; type: 2 (event_group)<br>defn: 28; size: 1; type: 0 (trigger)<br></td><td>81</td></tr><tr><td>19 (lap)</td><td>33</td><td>defn: 253; size: 4; type: 134 (timestamp)<br>defn: 2; size: 4; type: 134 (start_time)<br>defn: 3; size: 4; type: 133 (start_position_lat)<br>defn: 4; size: 4; type: 133 (start_position_long)<br>defn: 5; size: 4; type: 133 (end_position_lat)<br>defn: 6; size: 4; type: 133 (end_position_long)<br>defn: 7; size: 4; type: 134 (total_elapsed_time)<br>defn: 8; size: 4; type: 134 (total_timer_time)<br>defn: 9; size: 4; type: 134 (total_distance)<br>defn: 10; size: 4; type: 134 (total_cycles)<br>defn: 27; size: 4; type: 133 (unknown)<br>defn: 28; size: 4; type: 133 (unknown)<br>defn: 29; size: 4; type: 133 (unknown)<br>defn: 30; size: 4; type: 133 (unknown)<br>defn: 254; size: 2; type: 132 (message_index)<br>defn: 11; size: 2; type: 132 (total_calories)<br>defn: 12; size: 2; type: 132 (total_fat_calories)<br>defn: 13; size: 2; type: 132 (avg_speed)<br>defn: 14; size: 2; type: 132 (max_speed)<br>defn: 19; size: 2; type: 132 (avg_power)<br>defn: 20; size: 2; type: 132 (max_power)<br>defn: 21; size: 2; type: 132 (total_ascent)<br>defn: 22; size: 2; type: 132 (total_descent)<br>defn: 0; size: 1; type: 0 (event)<br>defn: 1; size: 1; type: 0 (event_type)<br>defn: 15; size: 1; type: 2 (avg_heart_rate)<br>defn: 16; size: 1; type: 2 (max_heart_rate)<br>defn: 17; size: 1; type: 2 (avg_cadence)<br>defn: 18; size: 1; type: 2 (max_cadence)<br>defn: 23; size: 1; type: 0 (intensity)<br>defn: 24; size: 1; type: 0 (lap_trigger)<br>defn: 25; size: 1; type: 0 (sport)<br>defn: 26; size: 1; type: 2 (event_group)<br></td><td>84</td></tr><tr><td>20 (record)</td><td>7</td><td>defn: 253; size: 4; type: 134 (timestamp)<br>defn: 0; size: 4; type: 133 (position_lat)<br>defn: 1; size: 4; type: 133 (position_long)<br>defn: 5; size: 4; type: 134 (distance)<br>defn: 2; size: 2; type: 132 (altitude)<br>defn: 6; size: 2; type: 132 (speed)<br>defn: 3; size: 1; type: 2 (heart_rate)<br></td><td>21</td></tr><tr><td>21 (event)</td><td>5</td><td>defn: 253; size: 4; type: 134 (timestamp)<br>defn: 3; size: 4; type: 134 (data)<br>defn: 0; size: 1; type: 0 (event)<br>defn: 1; size: 1; type: 0 (event_type)<br>defn: 4; size: 1; type: 2 (event_group)<br></td><td>11</td></tr><tr><td>22 (unknown)</td><td>10</td><td>defn: 253; size: 4; type: 134 (unknown)<br>defn: 0; size: 1; type: 2 (unknown)<br>defn: 1; size: 1; type: 2 (unknown)<br>defn: 2; size: 1; type: 2 (unknown)<br>defn: 3; size: 1; type: 2 (unknown)<br>defn: 4; size: 1; type: 2 (unknown)<br>defn: 5; size: 1; type: 0 (unknown)<br>defn: 6; size: 1; type: 2 (unknown)<br>defn: 7; size: 1; type: 2 (unknown)<br>defn: 8; size: 1; type: 2 (unknown)<br></td><td>13</td></tr><tr><td>23 (device_info)</td><td>15</td><td>defn: 253; size: 4; type: 134 (timestamp)<br>defn: 3; size: 4; type: 140 (serial_number)<br>defn: 7; size: 4; type: 134 (cum_operating_time)<br>defn: 8; size: 4; type: 134 (unknown)<br>defn: 15; size: 4; type: 134 (unknown)<br>defn: 16; size: 4; type: 134 (unknown)<br>defn: 2; size: 2; type: 132 (manufacturer)<br>defn: 4; size: 2; type: 132 (product)<br>defn: 5; size: 2; type: 132 (software_version)<br>defn: 10; size: 2; type: 132 (battery_voltage)<br>defn: 0; size: 1; type: 2 (device_index)<br>defn: 1; size: 1; type: 2 (device_type)<br>defn: 6; size: 1; type: 2 (hardware_version)<br>defn: 9; size: 1; type: 2 (unknown)<br>defn: 11; size: 1; type: 2 (battery_status)<br></td><td>37</td></tr><tr><td>34 (activity)</td><td>7</td><td>defn: 253; size: 4; type: 134 (timestamp)<br>defn: 0; size: 4; type: 134 (total_timer_time)<br>defn: 1; size: 2; type: 132 (num_sessions)<br>defn: 2; size: 1; type: 0 (type)<br>defn: 3; size: 1; type: 0 (event)<br>defn: 4; size: 1; type: 0 (event_type)<br>defn: 6; size: 1; type: 2 (event_group)<br></td><td>14</td></tr><tr><td>49 (file_creator)</td><td>2</td><td>defn: 0; size: 2; type: 132 (software_version)<br>defn: 1; size: 1; type: 2 (hardware_version)<br></td><td>3</td></tr><tr><td>79 (unknown)</td><td>9</td><td>defn: 253; size: 4; type: 134 (unknown)<br>defn: 0; size: 2; type: 132 (unknown)<br>defn: 3; size: 2; type: 132 (unknown)<br>defn: 1; size: 1; type: 2 (unknown)<br>defn: 2; size: 1; type: 2 (unknown)<br>defn: 4; size: 1; type: 0 (unknown)<br>defn: 5; size: 1; type: 0 (unknown)<br>defn: 6; size: 1; type: 2 (unknown)<br>defn: 7; size: 1; type: 1 (unknown)<br></td><td>14</td></tr></tbody></table><br><hr><br><h3>Messages found in file</h3><table class='table table-condensed table-striped'><thead><th>file_id</th><th>count()</th></thead><tbody><tr><td>serial_number</td><td>1</td></tr><tr><td>time_created</td><td>1</td></tr><tr><td>manufacturer</td><td>1</td></tr><tr><td>product</td><td>1</td></tr><tr><td>type</td><td>1</td></tr></tbody></table><br><br><table class='table table-condensed table-striped'><thead><th>file_creator</th><th>count()</th></thead><tbody><tr><td>software_version</td><td>1</td></tr></tbody></table><br><br><table class='table table-condensed table-striped'><thead><th>event</th><th>count()</th></thead><tbody><tr><td>timestamp</td><td>6</td></tr><tr><td>data</td><td>6</td></tr><tr><td>event</td><td>6</td></tr><tr><td>event_type</td><td>6</td></tr><tr><td>event_group</td><td>5</td></tr></tbody></table><br><br><table class='table table-condensed table-striped'><thead><th>device_info</th><th>count()</th></thead><tbody><tr><td>timestamp</td><td>6</td></tr><tr><td>serial_number</td><td>4</td></tr><tr><td>cum_operating_time</td><td>6</td></tr><tr><td>manufacturer</td><td>4</td></tr><tr><td>product</td><td>4</td></tr><tr><td>software_version</td><td>4</td></tr><tr><td>device_index</td><td>6</td></tr><tr><td>device_type</td><td>6</td></tr></tbody></table><br><br><table class='table table-condensed table-striped'><thead><th>record</th><th>count()</th></thead><tbody><tr><td>timestamp</td><td>2088</td></tr><tr><td>position_lat</td><td>2088</td></tr><tr><td>position_long</td><td>2088</td></tr><tr><td>distance</td><td>2088</td></tr><tr><td>altitude</td><td>2088</td></tr><tr><td>speed</td><td>2088</td></tr><tr><td>heart_rate</td><td>2088</td></tr></tbody></table><br><br><table class='table table-condensed table-striped'><thead><th>lap</th><th>count()</th></thead><tbody><tr><td>timestamp</td><td>1</td></tr><tr><td>start_time</td><td>1</td></tr><tr><td>start_position_lat</td><td>1</td></tr><tr><td>start_position_long</td><td>1</td></tr><tr><td>end_position_lat</td><td>1</td></tr><tr><td>end_position_long</td><td>1</td></tr><tr><td>total_elapsed_time</td><td>1</td></tr><tr><td>total_timer_time</td><td>1</td></tr><tr><td>total_distance</td><td>1</td></tr><tr><td>total_cycles</td><td>1</td></tr><tr><td>message_index</td><td>1</td></tr><tr><td>total_calories</td><td>1</td></tr><tr><td>total_fat_calories</td><td>1</td></tr><tr><td>avg_speed</td><td>1</td></tr><tr><td>max_speed</td><td>1</td></tr><tr><td>total_ascent</td><td>1</td></tr><tr><td>total_descent</td><td>1</td></tr><tr><td>event</td><td>1</td></tr><tr><td>event_type</td><td>1</td></tr><tr><td>avg_heart_rate</td><td>1</td></tr><tr><td>max_heart_rate</td><td>1</td></tr><tr><td>lap_trigger</td><td>1</td></tr><tr><td>sport</td><td>1</td></tr></tbody></table><br><br><table class='table table-condensed table-striped'><thead><th>session</th><th>count()</th></thead><tbody><tr><td>timestamp</td><td>1</td></tr><tr><td>start_time</td><td>1</td></tr><tr><td>start_position_lat</td><td>1</td></tr><tr><td>start_position_long</td><td>1</td></tr><tr><td>total_elapsed_time</td><td>1</td></tr><tr><td>total_timer_time</td><td>1</td></tr><tr><td>total_distance</td><td>1</td></tr><tr><td>total_cycles</td><td>1</td></tr><tr><td>nec_lat</td><td>1</td></tr><tr><td>nec_long</td><td>1</td></tr><tr><td>swc_lat</td><td>1</td></tr><tr><td>swc_long</td><td>1</td></tr><tr><td>message_index</td><td>1</td></tr><tr><td>total_calories</td><td>1</td></tr><tr><td>total_fat_calories</td><td>1</td></tr><tr><td>avg_speed</td><td>1</td></tr><tr><td>max_speed</td><td>1</td></tr><tr><td>total_ascent</td><td>1</td></tr><tr><td>total_descent</td><td>1</td></tr><tr><td>first_lap_index</td><td>1</td></tr><tr><td>num_laps</td><td>1</td></tr><tr><td>event</td><td>1</td></tr><tr><td>event_type</td><td>1</td></tr><tr><td>sport</td><td>1</td></tr><tr><td>sub_sport</td><td>1</td></tr><tr><td>avg_heart_rate</td><td>1</td></tr><tr><td>max_heart_rate</td><td>1</td></tr><tr><td>trigger</td><td>1</td></tr></tbody></table><br><br><table class='table table-condensed table-striped'><thead><th>activity</th><th>count()</th></thead><tbody><tr><td>timestamp</td><td>1</td></tr><tr><td>total_timer_time</td><td>1</td></tr><tr><td>num_sessions</td><td>1</td></tr><tr><td>type</td><td>1</td></tr><tr><td>event</td><td>1</td></tr><tr><td>event_type</td><td>1</td></tr></tbody></table><br><br>";
        
        $pFFA = new adriangibbons\phpFITFileAnalysis($this->base_dir . $this->valid_files[0]);
        $this->expectOutputString($debug_info);
        $pFFA->showDebugInfo();
    }
    
    /**
     * @expectedException Exception
     */
    public function testEmptyFilepath()
    {
        $pFFA = new adriangibbons\phpFITFileAnalysis('');
    }
    
    /**
     * @expectedException Exception
     */
    public function testFileDoesntExist()
    {
        $pFFA = new adriangibbons\phpFITFileAnalysis('file_doesnt_exist.fit');
    }
    
    /**
     * @expectedException Exception
     */
    public function testInvalidFitFile()
    {
        $file_path = $this->base_dir . '../composer.json';
        $pFFA = new adriangibbons\phpFITFileAnalysis($file_path);
    }
    
    
    public function testDemoFileBasics()
    {
        foreach($this->demo_files as $filename) {

            $pFFA = new adriangibbons\phpFITFileAnalysis($this->base_dir . $filename);
            
            $this->assertGreaterThan(0, $pFFA->data_mesgs['activity']['timestamp'], 'No Activity timestamp!');

            if (isset($pFFA->data_mesgs['record'])) {
                $this->assertGreaterThan(0, count($pFFA->data_mesgs['record']['timestamp']), 'No Record timestamps!');

                // Check if distance from record messages is +/- 2% of distance from session message
                if (is_array($pFFA->data_mesgs['record']['distance'])) {
                    $distance_difference = abs(end($pFFA->data_mesgs['record']['distance']) - $pFFA->data_mesgs['session']['total_distance'] / 1000);
                    $this->assertLessThan(0.02 * end($pFFA->data_mesgs['record']['distance']), $distance_difference, 'Session distance should be similar to last Record distance');
                }
                
                // Look for big jumps in latitude and longitude
                if (isset($pFFA->data_mesgs['record']['position_lat']) && is_array($pFFA->data_mesgs['record']['position_lat'])) {
                    foreach ($pFFA->data_mesgs['record']['position_lat'] as $key => $value) {
                        if (isset($pFFA->data_mesgs['record']['position_lat'][$key - 1])) {
                            if (abs($pFFA->data_mesgs['record']['position_lat'][$key - 1] - $pFFA->data_mesgs['record']['position_lat'][$key]) > 1) {
                                $this->assertTrue(false, 'Too big a jump in latitude');
                            }
                        }
                    }
                }
                if (isset($pFFA->data_mesgs['record']['position_long']) && is_array($pFFA->data_mesgs['record']['position_long'])) {
                    foreach ($pFFA->data_mesgs['record']['position_long'] as $key => $value) {
                        if (isset($pFFA->data_mesgs['record']['position_long'][$key - 1])) {
                            if (abs($pFFA->data_mesgs['record']['position_long'][$key - 1] - $pFFA->data_mesgs['record']['position_long'][$key]) > 1) {
                                $this->assertTrue(false, 'Too big a jump in longitude');
                            }
                        }
                    }
                }
            }
        }
    }
}
